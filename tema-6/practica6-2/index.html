
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://manuelgom5.github.io/mi-proyecto/tema-6/practica6-2/">
      
      
        <link rel="prev" href="../practica6-1/">
      
      
        <link rel="next" href="../practica6-3/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose - Mkdocs Manuel Gómez</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-62-despliegue-de-una-aplicacion-php-con-nginx-y-mysql-usando-docker-y-docker-compose" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Mkdocs Manuel Gómez" class="md-header__button md-logo" aria-label="Mkdocs Manuel Gómez" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mkdocs Manuel Gómez
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Mkdocs Manuel Gómez" class="md-nav__button md-logo" aria-label="Mkdocs Manuel Gómez" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Mkdocs Manuel Gómez
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-2/practica2-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividad 2.1 - Instalación y configuración servidor Nginx
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-2/practica2-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividad 2.2 - Autenticación en Nginx
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-2/practica2-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividad 2.3 - Proxy inverso con Nginx
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-2/practica2-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividad 2.4 - Balanceo de carga con proxy inverso en Nginx
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-2/practica2-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividad 2.5 - Proxy inverso y balanceo de carga con SSL en NGINX
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-2/practica2-6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 2.6 (Ampliación) - Configuración de un servidor Nginx con Hosts Virtuales y directorios de usuario
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-3/practica3-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividad 3.1 - Instalación de Tomcat
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-3/practica3-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividad 3.2 - Despiegue de Aplicaciones con Node Express y Netify
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-3/practica3-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 3.3 - Despliegue de una aplicación Flask (Python)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-4/practica4-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 4.1 - Configuración de un servidor DNS
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tema-5/practica5-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 5.1 - Ejercicios Git y GitHub
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica6-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.1 - Dockerización del despliegue de una aplicación con Node.js
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Práctica 6.2 - Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proceso-de-dockerizacion-de-nginxphpmysql" class="md-nav__link">
    <span class="md-ellipsis">
      Proceso de dockerización de Nginx+PHP+MySQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proceso de dockerización de Nginx+PHP+MySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-estructura-de-directorios" class="md-nav__link">
    <span class="md-ellipsis">
      1. Estructura de directorios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-creacion-de-un-contenedor-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      2. Creación de un contenedor Nginx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-creacion-de-un-contenedor-php" class="md-nav__link">
    <span class="md-ellipsis">
      3. Creación de un contenedor PHP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-de-nginx-para-ejecutar-php" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de Nginx para ejecutar PHP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-del-dockerfile-para-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del Dockerfile para Nginx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificacion-del-docker-composeyml" class="md-nav__link">
    <span class="md-ellipsis">
      Modificación del docker-compose.yml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-creacion-de-un-contenedor-para-datos" class="md-nav__link">
    <span class="md-ellipsis">
      4. Creación de un contenedor para datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-creacion-de-un-contenedor-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      5. Creación de un contenedor MySQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-verificacion-de-la-conexion-a-la-base-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      6. Verificación de la conexión a la base de datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-esquema-de-la-infraestructura-completa-de-contenedores" class="md-nav__link">
    <span class="md-ellipsis">
      7. Esquema de la infraestructura completa de contenedores
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica6-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Práctica 6.3 - Servidor web con usuarios autenticados mediante servicio de directorio (LDAP)
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proceso-de-dockerizacion-de-nginxphpmysql" class="md-nav__link">
    <span class="md-ellipsis">
      Proceso de dockerización de Nginx+PHP+MySQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proceso de dockerización de Nginx+PHP+MySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-estructura-de-directorios" class="md-nav__link">
    <span class="md-ellipsis">
      1. Estructura de directorios
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-creacion-de-un-contenedor-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      2. Creación de un contenedor Nginx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-creacion-de-un-contenedor-php" class="md-nav__link">
    <span class="md-ellipsis">
      3. Creación de un contenedor PHP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-de-nginx-para-ejecutar-php" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de Nginx para ejecutar PHP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuracion-del-dockerfile-para-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración del Dockerfile para Nginx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificacion-del-docker-composeyml" class="md-nav__link">
    <span class="md-ellipsis">
      Modificación del docker-compose.yml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-creacion-de-un-contenedor-para-datos" class="md-nav__link">
    <span class="md-ellipsis">
      4. Creación de un contenedor para datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-creacion-de-un-contenedor-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      5. Creación de un contenedor MySQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-verificacion-de-la-conexion-a-la-base-de-datos" class="md-nav__link">
    <span class="md-ellipsis">
      6. Verificación de la conexión a la base de datos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-esquema-de-la-infraestructura-completa-de-contenedores" class="md-nav__link">
    <span class="md-ellipsis">
      7. Esquema de la infraestructura completa de contenedores
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<p><strong>Autor: Manuel Gómez Ruiz</strong></p>
<p><strong>Asignatura: Despliegue de Aplicaciones Web</strong></p>
<p><strong>Fecha: 13/02/2025</strong></p>
<h1 id="practica-62-despliegue-de-una-aplicacion-php-con-nginx-y-mysql-usando-docker-y-docker-compose">Práctica 6.2: Despliegue de una aplicación PHP con Nginx y MySQL usando Docker y docker-compose</h1>
<h2 id="proceso-de-dockerizacion-de-nginxphpmysql">Proceso de dockerización de Nginx+PHP+MySQL</h2>
<p><strong>Objetivo de la práctica</strong>: Configurar una infraestructura de contenedores utilizando Docker Compose para crear un servicio web con <strong>Nginx, PHP</strong>, y una base de datos <strong>MySQL</strong>. La configuración también incluye la persistencia de datos de MySQL en un contenedor dedicado para almacenar las tablas de la base de datos.</p>
<h3 id="1-estructura-de-directorios">1.  Estructura de directorios</h3>
<p>Al finalizar esta práctica, nuestra estructura de directorios debe seguir la siguiente organización:</p>
<pre><code>/usuario/home/practica6-2/
├── docker-compose.yml
├── nginx
│   ├── default.conf
│   └── Dockerfile
├── php
│   └── Dockerfile
└── www
    └── html
        └── index.php
</code></pre>
<p>Para ello, comenzaremos creando la estructura de directorios y archivos necesarios. Más adelante, editaremos su contenido.</p>
<p>Ejecuta los siguientes comandos para crearlos:</p>
<pre><code>mkdir -p practica6-2/www/html
cd practica6-2
touch docker-compose.yml
mkdir nginx
cd nginx/
touch default.conf Dockerfile
cd ../
mkdir php
cd php/
touch Dockerfile
cd ../
cd www/html/
touch index.php
cd ../../
</code></pre>
<p><img alt="Creación de directorios y ficheros" src="img/Captura-1.JPG" /></p>
<p>Ya hemos generado la estructura de archivos y carpetas necesarias, ahora vamos a visualizar la jerarquía de directorios con la herramienta <strong>tree</strong>, la cual antes debemos instalar con el comando <code>sudo apt install tree</code>.</p>
<p><img alt="Descarga del paquete tree" src="img/Captura-2.JPG" /></p>
<p>Al ejecutar el comando <code>tree</code> dentro del directorio <strong>practica6-2</strong>, puedes verificar que tu estructura coincida con la esperada.</p>
<p><img alt="Árbol jerárquico con tree" src="img/Captura-3.JPG" /></p>
<h3 id="2-creacion-de-un-contenedor-nginx">2.  Creación de un contenedor Nginx</h3>
<p>El primer paso en la configuración de nuestro entorno será desplegar un contenedor <strong>Nginx</strong>, que servirá para alojar nuestra aplicación <strong>PHP</strong>.</p>
<p>Para ello, editamos el archivo <strong>docker-compose.yml</strong> con el comando <code>sudo nano docker-compose.yml</code>.</p>
<pre><code>nginx:
  image: nginx:latest
  container_name: nginx-container
  ports:
    - 80:80
</code></pre>
<p><img alt="Datos de configuración de imagen Nginx" src="img/Captura-4.JPG" /></p>
<p>Este archivo descargará la última versión de la <strong>imagen de Nginx</strong> desde Docker Hub, crea un contenedor llamado <strong>nginx-container</strong> y expone el puerto <strong>80</strong>, mapeándolo al puerto <strong>80</strong> de nuestra máquina anfitriona, permitiendo el acceso desde el navegador.</p>
<p>Una vez guardado el archivo, ejecutamos el siguiente comando para desplegar el contenedor en segundo plano <code>sudo docker compose up -d</code>.</p>
<p><img alt="Despliegue de Nginx" src="img/Captura-5.JPG" /></p>
<p>Ahora debemos verificar si el contenedor se ha iniciado correctamente, utilizando el comando <code>sudo docker ps</code>.</p>
<p><img alt="Comprobación de ejecución contenedor Nginx" src="img/Captura-6.JPG" /></p>
<p>Finalmente, abrimos nuestro navegador en la máquina anfitriona, y accedemos a <code>http://IP_SERVIDOR</code>. Si todo está correctamente configurado, veremos la página de bienvenida de Nginx.</p>
<p><img alt="Comprobar resultado desde navegador" src="img/Captura-7.JPG" /></p>
<h3 id="3-creacion-de-un-contenedor-php">3.  Creación de un contenedor PHP</h3>
<p>Para ejecutar código PHP dentro de nuestro contenedor, primero necesitamos editar el contenido de nuestro <strong>index.php</strong>. Para ello, utiliza el comando <code>sudo nano www/html/index.php</code> y añade el siguiente contenido:</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;head&gt;
  &lt;title&gt;¡Hola mundo!&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;h1&gt;¡Hola mundo!&lt;/h1&gt;
  &lt;p&gt;&lt;?php echo 'Estamos corriendo PHP, version: ' . phpversion(); ?&gt;&lt;/p&gt;
&lt;/body&gt;
</code></pre>
<p><img alt="Contenido de /www/html/index.php" src="img/Captura-8.JPG" /></p>
<p>Este archivo servirá como una prueba para comprobar que nuestro entorno PHP está funcionando correctamente.</p>
<h3 id="configuracion-de-nginx-para-ejecutar-php">Configuración de Nginx para ejecutar PHP</h3>
<p>Ahora debemos modificar el archivo de configuración de Nginx para permitir la ejecución de archivos PHP. Para ello, editamos <strong>nginx/default.conf</strong> con el comando <code>sudo nano nginx/default.conf</code>.</p>
<p>Dentro del archivo, agregamos la siguiente configuración:</p>
<pre><code>server {

    listen 80 default_server;  # Escucha en el puerto 80 como servidor predeterminado
    root /var/www/html;  # Define la raíz de los archivos que se servirán
    index index.html index.php;  # Define los archivos de índice que se buscarán en un directorio

    charset utf-8; # Codificación

    location / {
      # Intenta servir el archivo solicitado, si no existe, redirige a index.php
      try_files $uri $uri/ /index.php?$query_string;
    }

    # Excepciones para archivos favicon.ico y robots.txt para evitar registros innecesarios
    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt { access_log off; log_not_found off; }

    # Desactiva los logs de acceso y define el log de errores
    access_log off;
    error_log /var/log/nginx/error.log error;

    # Desactiva el uso de sendfile (mejora compatibilidad entornos virtualizados)
    sendfile off;

    # Define el tamaño máximo permitido para subir archivos a 100MB
    client_max_body_size 100m;

    # Configuración para procesar archivos PHP
    location ~ .php$ {
      fastcgi_split_path_info ^(.+.php)(/.+)$;
      fastcgi_pass php:9000;
      fastcgi_index index.php;
      include fastcgi_params;
      fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
      fastcgi_intercept_errors off;
      fastcgi_buffer_size 16k;
      fastcgi_buffers 4 16k;
    }

    # Restringe el acceso a archivos .ht* por seguridad
    location ~ /.ht {
      deny all;
    }
    }
</code></pre>
<p><img alt="Configuración archivo default Nginx" src="img/Captura-9.JPG" /></p>
<h3 id="configuracion-del-dockerfile-para-nginx">Configuración del Dockerfile para Nginx</h3>
<p>Accedemos al archivo <strong>Dockerfile</strong> dentro de la carpeta <strong>Nginx</strong>, para asegurarnos de que el contenedor de Nginx utilice nuestra configuración personalizada. Para ello, editamos el archivo con el comando <code>sudo nano practica6-2/nginx/Dockerfile</code>.</p>
<p>Añade las siguientes instrucciones:</p>
<pre><code># Usamos la imagen oficial de Nginx en su última versión
FROM nginx:latest
# Copiamos nuestro archivo de configuración personalizado &quot;default.conf&quot; en el directorio Nginx
COPY ./default.conf /etc/nginx/conf.d/default.conf
</code></pre>
<p><img alt="Archivo Dockerfile Nginx" src="img/Captura-10.JPG" /></p>
<h3 id="modificacion-del-docker-composeyml">Modificación del docker-compose.yml</h3>
<p>Accedemos a <strong>docker-compose.yml</strong> para incluir el servicio de PHP-FMP y enlazarlo con Nginx. Para ello usa el comando <code>sudo nano docker-compose.yml</code>.</p>
<pre><code>services:
  nginx:
    build: ./nginx/ # Construye la imagen con el Dockerfile dentro de la carpeta Nginx
    container_name: nginx-container
    ports:
      - 80:80 # Puerto de mapeo
    links:
      - php # Conectamos nginx con el contenedor PHP
    volumes:
      - ./www/html/:/var/www/html/  # Montamos la carpeta local www/html/ en /var/www/html dentro del contenedor

  php:
    image: php:7.0-fpm  # Usamos la imagen oficial de PHP con fastCGI Process Manager
    container_name: php-container
    expose:
      - 9000  # Exponemos el puerto 9000 para comunicación con Nginx
    volumes:
      - ./www/html/:/var/www/html/  # Montamos la carpeta www/html en var/www/html dentro del contenedor
</code></pre>
<p><img alt="Configuración docker compose" src="img/Captura-11.JPG" /></p>
<p>Este fichero <strong>docker-compose.yml</strong> se creará un nuevo contenedor <strong>PHP-FPM</strong> en el <strong>puerto 9000</strong>, enlazará el contenedor Nginx con el contenedor PHP, así como creará un volumen y lo montará en el directorio /var/www/html de los contenedores.</p>
<p>Con todo esto configurado, ejecutamos nuevamente <code>docker-compose</code> para desplegar ambos contenedores:</p>
<p><img alt="Ejecución imagen PHP" src="img/Captura-12.JPG" /></p>
<p>Verificamos que ambos contenedores están en ejecución, utilizando el comando <code>docker ps</code>.</p>
<p><img alt="Visualizando contenedores ejecutados" src="img/Captura-13.JPG" /></p>
<p>Si todo está funcionando correctamente, podremos acceder a <code>http://IP_SERVIDOR</code> desde nuestro anfitrión y visualizar la salida del archivo <code>index.php</code>, confirmando que PHP se está ejecutando dentro del contenedor.</p>
<h3 id="4-creacion-de-un-contenedor-para-datos">4.  Creación de un contenedor para datos</h3>
<p>Hasta ahora, hemos montado el directorio <code>www/html</code> en ambos contenedores (<code>nginx</code> y <code>php</code>). Sin embargo, esta no es la mejor práctica, ya que cada contenedor mantiene su propio sistema de archivos.</p>
<p>En esta sección, vamos a crear un <strong>contenedor de datos</strong> independiente llamado <code>app-data</code>, que se encargará de almacenar los archivos de nuestra aplicación. Luego, este contenedor se enlazará con los otros servicios para compartir los datos de manera eficiente.</p>
<p>Primero edita el archivo <strong>docker-compose.yml</strong>  con el comando <code>sudo nano /usuario/home/practica6-2/docker-compose.yml</code>.</p>
<p>Y añade el servicio app-data:</p>
<pre><code>nginx:
  build: ./nginx/
  container_name: nginx-container
  ports:
    - 80:80
  links:
    - php
  volumes_from:
    - app-data  # Usa los volúmenes del contenedor app-data

php:
  image: php:7.0-fpm
  container_name: php-container
  expose:
    - 9000
  volumes_from:
    - app-data  # Usa volúmenes del contenedor app-data

app-data: # Contenedor para el almacenamiento de archivos de la aplicación
  image: php:7.0-fpm  # Usa la imagen PHP como almacenamiento de datos
  container_name: app-data-container  # Asigna un nombre al contenedor de datos
  volumes: 
    - ./www/html/:/var/www/html/
  command: &quot;true&quot; # Evita que el contenedor ejecute servicios, solo mantiene los datos
</code></pre>
<p><img alt="Añadimos un nuevo servicio al docker compose" src="img/Captura-14.JPG" /></p>
<p>Ejecutamos la nueva configuración con <code>docker-compose up -d</code>.</p>
<p><img alt="Ejecución del nuevo servicio" src="img/Captura-15.JPG" /></p>
<p>Verificamos el estado de los contenedores, para asegurarnos de que todo funciona correctamente, el comando <code>docker ps</code> no nos sirve ya que también queremos ver el contenedor de <strong>app-data</strong> y con <code>docker-ps</code> solo se ven los contenedores en ejecución, si queremos mostrar toda la lista de contenedores junto a sus detalles debemos usar <code>sudo docker ps -a</code>.</p>
<p><img alt="Estado de ejecución y datos sobre contenedores" src="img/Captura-16.JPG" /></p>
<h3 id="5-creacion-de-un-contenedor-mysql">5.  Creación de un contenedor MySQL</h3>
<p>En esta sección, añadiremos un contenedor de una base de datos MySQL y lo enlazaremos con el resto de servicios.</p>
<p>Primero, modificaremos la imagen PHP e <strong>instalaremos</strong> la extensión PHP para <strong>MySQL</strong>, de tal forma que nos permita conectarnos desde nuestra aplicación PHP a nuestra BBDD MySQL.</p>
<p>Accedemos a nuestro archivo <strong>Dockerfile</strong> dentro de <strong>php/</strong> con el comando <code>sudo nano php/Dockerfile</code> e incluimos el siguiente contenido:</p>
<pre><code>FROM php:7.0-fpm  # Usa la imagen oficial de PHP con FPM
RUN docker-php-ext-install pdo_mysql  # Instala la extensión PDO para MySQL
</code></pre>
<p><img alt="Archivo Dockerfile PHP" src="img/Captura-17.JPG" /></p>
<p>Debemos editar <strong>docker-compose.yml</strong> con el objetivo de que se <strong>creen</strong> el contenedor para <strong>MySQL</strong> y el contenedor de los datos de MySQL que contendrá la <strong>base de datos</strong> y las <strong>tablas</strong>:</p>
<pre><code>services:
  nginx:
    build: ./nginx/
    container_name: nginx-container
    ports:
      - 80:80
    links:
      - php
    volumes_from:
      - app-data
  php:
    build: ./php/
    container_name: php-container
    expose:
      - 9000
    links:
      - mysql # Conexión con el contenedor MySQL
    volumes_from:
      - app-data

  app-data:
    image: php:7.0-fpm
    container_name: app-data-container
    volumes:
      - ./www/html/:/var/www/html/
    command: &quot;true&quot;

  mysql:  # Servicio de base de datos MySQL
    image: mysql:5.7  # Usa la imagen oficial de MySQL 5.7
    container_name: mysql-container
    volumes_from:
      - mysql-data
    environment:  # Variables de entorno para la configuración de MySQL
      MYSQL_ROOT_PASSWORD: secret
      MYSQL_DATABASE: mydb
      MYSQL_USER: myuser
      MYSQL_PASSWORD: password

  mysql-data: # Contenedor para almacenar los datos de MySQL
    image: mysql:5.7
    container_name: mysql-data-container
    volumes:
      - /var/lib/mysql  # Almacena los datos de un volumen persistente
    command: &quot;true&quot; # Evita que el contenedor ejecute MySQL, solo mantiene los datos
</code></pre>
<p><img alt="Archivo docker compose" src="img/Captura-18.JPG" /></p>
<p>El archivo <strong>index.php</strong> dentro de <strong>www/html/</strong> debe quedar con el siguiente contenido para comprobar la conexión a la base de datos.</p>
<pre><code>     &lt;!DOCTYPE html&gt;
     &lt;head&gt;
      &lt;title&gt;¡Hola mundo!&lt;/title&gt;
     &lt;/head&gt;

     &lt;body&gt;
      &lt;h1&gt;¡Hola mundo!&lt;/h1&gt;
      &lt;p&gt;&lt;?php echo 'Estamos corriendo PHP, version: ' . phpversion(); ?&gt;&lt;/p&gt;
      &lt;?
        $database =&quot;mydb&quot;;
        $user = &quot;myuser&quot;;
        $password = &quot;password&quot;;
        $host = &quot;mysql&quot;; //  Nombre del servicio en docker-compose

        //  Conexión a la base de datos MySQL usando POO
        $connection = new PDO(&quot;mysql:host={$host};dbname={$database};charset=utf8&quot;, $user, $password);

        //  Consulta para obtener las tablas en la base de datos
        $query = $connection-&gt;query(&quot;SELECT TABLE_NAME FROM information_schema.TABLES WHERE TABLE_TYPE='BASE TABLE'&quot;);
        $tables = $query-&gt;fetchAll(PDO::FETCH_COLUMN);

        if (empty($tables)) {
          echo &quot;&lt;p&gt;No hay tablas en la base de datos \&quot;{$database}\&quot;.&lt;/p&gt;&quot;;
        } else {
          echo &quot;&lt;p&gt;La base de datos \&quot;{$database}\&quot; tiene las siguientes tablas:&lt;/p&gt;&quot;;
          echo &quot;&lt;ul&gt;&quot;;
            foreach ($tables as $table) {
              echo &quot;&lt;li&gt;{$table}&lt;/li&gt;&quot;;
            }
          echo &quot;&lt;/ul&gt;&quot;;
        }
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><img alt="Archivo index.php" src="img/Captura-19.JPG" /></p>
<p>Guardar el archivo y reconstruir los contenedores una vez más con <code>docker compose up -d</code>.</p>
<p><img alt="Levantamos los contenedores" src="img/Captura-20.JPG" /></p>
<p>Verificamos el estado de los contenedores con <code>docker ps -a</code>.</p>
<p><img alt="Verificamos estado de los contenedores" src="img/Captura-21.JPG" /></p>
<h3 id="6-verificacion-de-la-conexion-a-la-base-de-datos">6.  Verificación de la conexión a la base de datos</h3>
<p>INFORMACIÓN IMPORTANTE: Aunque en muchas de mis capturas de pantalla se muestra que estoy utilizando PHP FPM versión 7.0, al final tuve que cambiar a la versión 8.1 debido a incompatibilidades con la base de datos. Si bien la versión 7.0 debería funcionar sin problemas, en caso de que encuentres algún error, te sugiero que pruebes con una versión más reciente, como la 8.1.</p>
<p>Si accedes a <strong>HTTP://IP_SERVIDOR</strong>, la página deberá mostrar el mensaje "No hay tablas en la base de datos <code>mydb</code>". Esto puede causar confusión, ya que en realidad existen tablas en la base de datos. Sin embargo, estas no son visibles para el usuario actual, ya que está utilizando un usuario con permisos limitados.</p>
<p><img alt="Acceso inicial a la página web" src="img/Captura-22.JPG" /></p>
<p>Para poder ver todas las tablas, necesitamos usar un usuario con mejores permisos. En este caso, utilizaremos el usuario <strong>root</strong>, que tiene permisos c
ompletos sobre todas las bases de datos y tablas en MySQL</p>
<p>Para hacerlo, debemos editar el archivo <code>index.php</code>, <code>sudo nano www/html/index.php</code>.</p>
<p>Busca las credenciales de conexión, <strong>$user</strong> y <strong>$password</strong> y cámbialas para que utilicen las credenciales del usuario <strong>root</strong>.</p>
<p><code>$user = "root";
$password = "secret";</code></p>
<p><img alt="Modificación usuario y contraseña" src="img/Captura-23.JPG" /></p>
<p>Guarda el archivo y refresca la página. Deberías obtener ahora una pantalla con todas las tablas de la base de datos, tal que así:</p>
<p><img alt="Tablas base de datos usuario root" src="img/Captura-24.JPG" /></p>
<h3 id="7-esquema-de-la-infraestructura-completa-de-contenedores">7.  Esquema de la infraestructura completa de contenedores</h3>
<p>Finalmente, aquí tienes el esquema que muestra cómo están organizados los contenedores en la infraestructura:</p>
<p><img alt="Infraestructura contenedores" src="img/Captura-25.JPG" /></p>
<p>Este esquema ilustra cómo los contenedores de <strong>Nginx</strong>, <strong>PHP</strong>, <strong>MySQL</strong> y <strong>almacenamiento de datos</strong> interactúan entre sí para servir la aplicación web, gestionar la base de datos y almacenar los datos de manera persistente.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
  </body>
</html>